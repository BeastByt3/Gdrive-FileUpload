<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Senior High School Profiling Form</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
    form { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; margin: 0 auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
    button { background-color: #9b1c20; color: #fff; padding: 12px; border: none; border-radius: 5px; margin-top: 20px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; }
    button:hover { background-color: #7e161a; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }
    /* --- NEW STYLES --- */
    #aiResult { margin-top: 20px; background-color: #e9f5ff; border: 1px solid #bce8f1; border-radius: 8px; padding: 15px; white-space: pre-wrap; display: none; }
  </style>
</head>
<body>

  <form id="shsForm">
    <h2>Senior High School Profiling Form</h2>

    <label for="region">Region</label>
    <select id="region" name="region" required>
        <option value="">Select Region</option>
        <option value="IV-A">Region IV-A</option>
    </select>
    <label for="province">Province</label>
    <select id="province" name="province" required>
        <option value="">Select Province</option>
        <option value="Batangas">Batangas</option>
        <option value="Cavite">Cavite</option>
        <option value="Laguna">Laguna</option>
        <option value="Quezon">Quezon</option>
        <option value="Rizal">Rizal</option>
    </select>
    <label for="city">City/Municipality</label>
    <select id="city" name="city" required>
        <option value="">Select City/Municipality</option>
    </select>
    <label for="lastName">Last Name</label><input type="text" id="lastName" name="lastName" required>
    <label for="firstName">First Name</label><input type="text" id="firstName" name="firstName" required>
    <label for="track">Track</label>
    <select id="track" name="track" required>
        <option value="">Select</option>
        <option>Academic</option>
        <option>Technical-Vocational-Livelihood</option>
    </select>
    <label for="strand">Strand</label>
    <select id="strand" name="strand" required>
        <option value="">Select a track first</option>
    </select>
    
    <button type="submit" id="submitButton">Submit and Generate AI Profile</button>
    
    <div id="aiResult"></div>
  </form>

  <script>
    // --- YOUR EXISTING DROPDOWN LOGIC (UNCHANGED) ---
    const cityData = { Batangas: ["Batangas City", "Lipa City", "Tanauan City"], Cavite: ["Tagaytay City", "Imus", "Bacoor"], Laguna: ["San Pablo", "Calamba", "Sta. Rosa"], Quezon: ["Lucena City", "Tayabas", "Candelaria"], Rizal: ["Antipolo", "Binangonan", "Cainta"] };
    document.getElementById('province').addEventListener('change', function() {
      const cities = cityData[this.value] || [];
      const citySelect = document.getElementById('city');
      citySelect.innerHTML = '<option value="">Select City/Municipality</option>';
      cities.forEach(city => {
        const option = document.createElement('option');
        option.textContent = city;
        option.value = city; // Make sure value is set
        citySelect.appendChild(option);
      });
    });
    document.getElementById('track').addEventListener('change', function() {
        const strand = document.getElementById('strand');
        strand.innerHTML = '<option value="">Select Strand</option>';
        if (this.value === 'Academic') {
            ['STEM', 'ABM', 'HUMSS', 'GAS'].forEach(s => {
                const option = document.createElement('option');
                option.text = s;
                option.value = s;
                strand.appendChild(option);
            });
        } else if (this.value === 'Technical-Vocational-Livelihood') {
             ['ICT', 'Home Economics', 'Industrial Arts'].forEach(s => {
                const option = document.createElement('option');
                option.text = s;
                option.value = s;
                strand.appendChild(option);
            });
        }
    });

    // --- NEW SUBMISSION LOGIC ---
    document.getElementById('shsForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const submitButton = document.getElementById('submitButton');
      const aiResultDiv = document.getElementById('aiResult');
      const formData = new FormData(this);
      // Important: Use Object.fromEntries to convert FormData to a plain object
      const data = Object.fromEntries(formData.entries());

      // Disable button and show loading message
      submitButton.disabled = true;
      submitButton.textContent = 'Processing...';
      aiResultDiv.style.display = 'block';
      aiResultDiv.innerHTML = 'üß† Generating student profile with Gemini AI...';

      // This is the endpoint on your Render server we will create next
      const endpoint = 'https://casemanagement-server.onrender.com/submit-shs';

      fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(response => {
        if (!response.ok) throw new Error(`Server error: ${response.statusText}`);
        return response.json();
      })
      .then(result => {
        // Display the AI summary received from the server
        aiResultDiv.innerHTML = `<strong>‚úÖ Success! AI Student Profile:</strong><hr>${result.aiProfile}`;
        submitButton.textContent = 'Submitted Successfully!';
      })
      .catch(error => {
        console.error('Error:', error);
        aiResultDiv.innerHTML = '‚ùå Error submitting form or getting AI profile. Please check the server logs.';
        submitButton.disabled = false;
        submitButton.textContent = 'Submit and Generate AI Profile';
      });
    });
  </script>
</body>
</html>