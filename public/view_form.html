<!DOCTYPE html>
<html lang="en">
<head>
    </head>
<body>
    <div class="page-container">
        <div class="main-content">
            <div class="form-wrapper">
                <h2 id="form-title">Loading...</h2>
                <p id="form-description"></p>
                <form id="dynamic-form"></form>
                <div id="submit-status"></div>
            </div>
        </div>
    </div>

    <script>
        // ... (All the existing JavaScript for rendering the form is the same) ...

        // === FINAL, UPDATED SUBMISSION LOGIC ===
        formContainer.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitButton = formContainer.querySelector('button[type="submit"]');
            const formData = new FormData(formContainer);
            const submissionData = Object.fromEntries(formData.entries());

            // NEW: We now create a payload that includes the form's ID
            const payload = {
                formId: currentFormId, // We get this from the onload function
                submissionData: submissionData
            };
            
            if (!payload.formId) {
                alert("Error: Form ID is missing. Cannot submit.");
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = 'Submitting data...';

            // We will use a new, smarter endpoint
            const endpoint = 'https://casemanagement-server.onrender.com/submit-form';

            fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload) // Send the new payload
            })
            .then(response => response.json())
            .then(result => {
                if (!result.success) { throw new Error(result.error || 'Unknown error'); }
                statusDiv.innerHTML = `<strong>✅ Success!</strong><br>Your submission has been saved.`;
                formContainer.reset();
            })
            .catch(error => {
                console.error('Error:', error);
                statusDiv.innerHTML = '❌ Error submitting form. Please try again.';
            })
            .finally(() => {
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Form';
            });
        });
    </script>
</body>
</html>