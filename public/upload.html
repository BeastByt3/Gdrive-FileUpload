<!DOCTYPE html>
<html lang="en">
<head>
  </head>
<body>
  <div class="page-container">
    <div class="sidebar" id="sidebar">
      <a href="upload.html" class="active">üì§ Upload Files</a>
    </div>

    <div class="main-content">
      <header class="header-bar">
        </header>
      <div class="form-wrapper">
        <h2>üì§ Upload Tool</h2>
        <form id="uploadForm">
          <label for="file">Select File <span style="color:#d9534f;">*</span></label>
          <input type="file" id="file" name="file" required>
          <button type="submit" id="submitButton">Upload File</button>
        </form>
        <div id="status" style="display:none; margin-top: 20px;"></div>
      </div>
    </div>
  </div>
  
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    // --- Mobile menu script here ---

    // --- Logic to load dropdowns from Firestore (unchanged) ---
    // const firebaseConfig = { ... };
    // async function loadUploadSettings() { ... }
    // window.onload = loadUploadSettings;

    // --- NEW: File Upload Submission Logic ---
    const uploadForm = document.getElementById('uploadForm');
    const statusDiv = document.getElementById('status');
    const submitButton = document.getElementById('submitButton');

    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(uploadForm);
      const fileInput = document.getElementById('file');
      
      if (!fileInput.files || fileInput.files.length === 0) {
        statusDiv.textContent = 'Please select a file to upload.';
        statusDiv.style.color = 'red';
        statusDiv.style.display = 'block';
        return;
      }
      
      submitButton.disabled = true;
      submitButton.textContent = 'Uploading...';
      statusDiv.style.display = 'block';
      statusDiv.innerHTML = 'Uploading file to server. Please wait...';

      const endpoint = 'https://casemanagement-server.onrender.com/upload-file';

      try {
        const response = await fetch(endpoint, {
          method: 'POST',
          body: formData, // When sending FormData, browser sets the Content-Type header automatically
        });

        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.error || 'Server error');
        }

        statusDiv.innerHTML = `<strong>‚úÖ Success!</strong><br>${result.message}`;
        uploadForm.reset(); // Clear the form
        
      } catch (error) {
        console.error('Upload error:', error);
        statusDiv.innerHTML = '‚ùå Error uploading file. Please try again.';
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = 'Upload File';
      }
    });
  </script>
</body>
</html>